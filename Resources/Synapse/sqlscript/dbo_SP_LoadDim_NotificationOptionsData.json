{
	"name": "dbo_SP_LoadDim_NotificationOptionsData",
	"properties": {
		"folder": {
			"name": "ws-ent-syn-serverlessdb-001/StoredProcedure"
		},
		"content": {
			"query": "/****** Object:  StoredProcedure [dbo].[SP_LoadDim_NotificationOptionsData]    Script Date: 12/22/2022 5:09:27 AM ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\n\n\nCREATE OR ALTER  PROCEDURE [dbo].[SP_LoadDim_NotificationOptionsData]\n\n( \n    @GetNewWaterMark bit=0,@RowValidFrom Datetime2(7)='1900-01-01 00:00:00.0000000'\n)\nAS\nBegin \nSET LANGUAGE us_english;\n\n\tIF @GetNewWaterMark>0\t\n    BEGIN\n    SELECT isnull(max(RowValidFrom),@RowValidFrom) AS RowValidFrom\n\t\t\tFROM [dbo].[ws_notification] \n\t\t\tWHERE CAST(RowValidFrom As datetime2(7))>@RowValidFrom\n\tEND\n\tELSE\nWITH CTE_NotificationOptionsData\nAS (\nSELECT \n \n CASE \n\t\tWHEN ws_senttotriage = '741120000'\n\t\t\tTHEN 'YES'\n\t\tWHEN ws_senttotriage = '741120001'\n\t\t\tTHEN 'NO'\n\t\tELSE NULL\n\t\tEND AS [IsSentToTriage]\n\t,CONVERT(DATETIMEOFFSET, ws_senttotriageon) AS [SenttoTriageDate]\n\t,CASE \n\t\tWHEN ws_sendfatalnotification = '741120000'\n\t\t\tTHEN 'YES'\n\t\tWHEN ws_sendfatalnotification = '741120001'\n\t\t\tTHEN 'NO'\n\t\tELSE NULL\n\t\tEND AS [IsSendFatalNotification],\n\t\t CASE\n                WHEN ws_notifiableevent = 741120000 THEN 'Yes'\n                WHEN ws_notifiableevent = 741120001 THEN 'No'\n                ELSE NULL\n              END                                  AS [IsNotifiableEvent],\n\n\t\t CASE\n                WHEN ws_channel = 741120000 THEN 'After Hours'\n                WHEN ws_channel = 741120001 THEN 'Email'\n                WHEN ws_channel = 741120002 THEN 'Fax'\n                WHEN ws_channel = 741120003 THEN 'Social Media'\n                WHEN ws_channel = 741120004 THEN 'Webform'\n                WHEN ws_channel = 741120005 THEN 'Phone Call'\n                WHEN ws_channel = 741120006 THEN 'Internal (Media)'\n                WHEN ws_channel = 741120007 THEN 'Overflow with MBIE'\n                WHEN ws_channel = 741120008 THEN 'Letter'\n                WHEN ws_channel = 741120009 THEN 'Portal '\n                ELSE NULL\n              END                                  AS [NotificationChannel],\n              CASE\n                WHEN ws_notificationreceivedfrom = 741120000 THEN\n                'External Agency'\n                WHEN ws_notificationreceivedfrom = 741120001 THEN 'PCBU'\n                WHEN ws_notificationreceivedfrom = 741120002 THEN 'Public'\n                WHEN ws_notificationreceivedfrom = 741120003 THEN 'Other'\n                WHEN ws_notificationreceivedfrom = 741120004 THEN\n                'Compliance Certifier'\n              END                                  AS\n              [NotificationReceivedFrom],\n              CASE\n                WHEN ws_notificationpriority = 717760000 THEN 'High'\n                WHEN ws_notificationpriority = 717760001 THEN 'Med'\n                WHEN ws_notificationpriority = 717760002 THEN 'Low'\n              END                                  AS [NotificationPriority],\n              CASE\n                WHEN ws_typeofnotification = 741120000 THEN 'Death'\n                WHEN ws_typeofnotification = 741120001 THEN\n                'Health and Safety Concern'\n                WHEN ws_typeofnotification = 741120002 THEN 'Illness'\n                WHEN ws_typeofnotification = 741120003 THEN\n                'Immediate Risk of Harm'\n                WHEN ws_typeofnotification = 741120004 THEN 'Incident'\n                WHEN ws_typeofnotification = 741120005 THEN 'Injury'\n                WHEN ws_typeofnotification = 741120006 THEN\n                'Mentally Healthy at Work'\n                WHEN ws_typeofnotification = 741120007 THEN\n                'Notification of Refusal'\n                ELSE NULL\n              END                                  AS [NotificationType],\n              CASE\n                WHEN ws_notifiableevent = 741120000 THEN 'Yes'\n                WHEN ws_notifiableevent = 741120001 THEN 'No'\n                ELSE NULL\n              END                                  AS [NotifiableEvent],\n\t\n\tCASE\n                WHEN ws_sensitivecontent = 741120000 THEN 'Yes'\n                WHEN ws_sensitivecontent = 741120001 THEN 'No'\n              END                                  AS [IsSensitiveContent],\n\n\t\t\t  CASE\n                WHEN ws_escalateoutcomereason = 741120000 THEN 'Priority area'\n                WHEN ws_escalateoutcomereason = 741120001 THEN\n                'Initial interaction with PCBU'\n                WHEN ws_escalateoutcomereason = 741120002 THEN\n                'Requires further information or onsite follow up'\n                WHEN ws_escalateoutcomereason = 741120003 THEN\n                'Requires team with specialist knowledge'\n                WHEN ws_escalateoutcomereason = 741120004 THEN 'Investigation'\n                WHEN ws_escalateoutcomereason = 741120005 THEN\n                'History of non-compliance in a similar matter'\n                WHEN ws_escalateoutcomereason = 741120006 THEN\n                'Duty Holder Review'\n                ELSE NULL\n              END                                  AS [EscalateToCaseReason],\n\n\tws_notificationid AS [Notification ID]\n\t,row_number() OVER (\n\t\t\tPARTITION BY id ORDER BY versionnumber DESC\n\t\t\t) AS row_num\nFROM [dbo].[ws_notification] A \nwhere CAST(A.RowValidFrom as datetime2(7)) > @RowValidFrom \nAND A.RowIsCurrent='true')\n\nSELECT \n\n--row_number() OVER (\n--\t\tORDER BY [Notification ID]\n--\t\t) + 1000 AS Notification_Option_Set_Key\n     [IsSentToTriage]\n\t ,[IsNotifiableEvent]\n\t ,[IsSendFatalNotification]\n\t,[IsSensitiveContent]\n\t, [NotificationChannel]\n\t, [NotificationType]\n\t, [NotificationReceivedFrom]\n\t,[NotificationPriority]\n\t, [EscalateToCaseReason]\n\t ,[Notification ID] as [NotificationID]\n\t\nFROM CTE_NotificationOptionsData\nWHERE row_num = 1 and [Notification ID] is not null\nUNION \nSELECT \nNull,\nNull,\nNull,\nNull,\nNull,\nNull,\nNull,\nNull,\nNull,\n'UNKNOWN'\n\nEnd\nGO\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "wsentsynserverlessdb001",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}